import{u as c,a as l}from"./CjkzigEY.js";import{B as p,J as f,k as h,A as y,p as g}from"./D2ZHngAM.js";const d="$s";function v(...t){const u=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(u);const[e,s]=t;if(!e||typeof e!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+e);if(s!==void 0&&typeof s!="function")throw new Error("[nuxt] [useState] init must be a function: "+s);const a=d+e,i=p(),r=f(i.payload.state,a);if(r.value===void 0&&s){const o=s();if(h(o))return i.payload.state[a]=o,o;r.value=o}return r}const w=()=>{const{fetchWithAuth:t}=c(),u=v("auth_user",()=>null),e=l("auth_token",{maxAge:3600*24,path:"/"}),s=y(()=>!!e.value);return{user:u,token:e,isLoggedIn:s,register:async o=>{try{return await t("/auth/register",{method:"POST",body:o})}catch(n){throw n}},login:async o=>{try{const n=await t("/auth/login",{method:"POST",body:o});return e.value=n.accessToken,u.value=n.user,n}catch(n){throw n}},logout:()=>{e.value=null,u.value=null,g("/login")}}};export{w as u};
