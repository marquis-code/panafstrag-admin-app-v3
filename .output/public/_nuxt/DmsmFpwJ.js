import{d as k,o as A,a as V,b as a,c as l,e as t,n as h,t as o,j as C,B,g as p,F as b,h as v,r as d,u as T,i as $}from"./CEj_7URL.js";import{u as S}from"./DB5CxoXR.js";const j={class:"space-y-6"},D={class:"flex items-center justify-between"},M={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},P={class:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden"},E={class:"text-3xl font-light"},N={class:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden"},R={class:"text-3xl font-light"},z={class:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden"},F={class:"text-3xl font-light"},H={class:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden"},U={class:"text-3xl font-light"},I={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},L={class:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-[600px]"},q={class:"p-6 border-b border-gray-50 flex items-center justify-between"},G={class:"p-6 overflow-y-auto custom-scrollbar flex-1 space-y-4"},J={key:0,class:"text-center py-8"},K={class:"mt-1 flex flex-col items-center"},O={class:"flex-1 pb-4"},Q={class:"flex justify-between items-start mb-1"},W={class:"text-sm font-bold text-gray-900"},X={class:"text-xs text-gray-500 ml-2"},Y={class:"text-[10px] text-gray-400 font-medium"},Z={key:0,class:"text-sm text-gray-600"},tt={class:"font-mono text-xs bg-gray-50 px-1 py-0.5 rounded"},et={key:1,class:"text-sm text-gray-600 italic"},st={class:"text-[10px] text-gray-400 mt-1 uppercase tracking-wider"},ot={class:"space-y-6"},rt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},at={class:"p-4 space-y-2"},lt={class:"text-sm font-mono text-gray-600 truncate mr-4"},it={class:"text-xs font-bold bg-gray-100 px-2 py-1 rounded text-gray-600"},nt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},dt={class:"p-4 space-y-3"},ut={class:"text-sm font-bold"},gt={class:"text-[10px] text-gray-500"},ct={class:"flex justify-between items-center mt-2 pt-2 border-t border-gray-100"},pt={class:"text-[10px] font-bold uppercase tracking-wider text-gray-400"},bt={class:"text-[10px] text-gray-400"},ht=k({__name:"audit-trail",setup(vt){const x=T(),m=S("auth_token"),u=d([]),i=d({}),n=d(!1),g=d(""),c=async()=>{n.value=!0;try{const[r,e]=await Promise.all([$fetch(`${x.public.apiBase}/chat/activities`,{headers:{Authorization:`Bearer ${m.value}`},query:{limit:50,event:g.value||void 0}}),$fetch(`${x.public.apiBase}/chat/activity-stats`,{headers:{Authorization:`Bearer ${m.value}`}})]);u.value=r.activities||[],i.value=e||{}}catch(r){console.error("Failed to fetch audit trail data",r)}finally{n.value=!1}};A(()=>{c()});const y=r=>({page_visit:"bg-blue-500 ring-blue-100",chat_message:"bg-green-500 ring-green-100",bot_reply:"bg-purple-500 ring-purple-100",form_submit:"bg-yellow-500 ring-yellow-100",session_start:"bg-gray-800 ring-gray-100"})[r]||"bg-gray-400 ring-gray-50",f=r=>r.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),w=r=>new Date(r).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),_=r=>{const e=Math.floor((new Date().getTime()-new Date(r).getTime())/1e3);return e<60?`${e}s ago`:e<3600?`${Math.floor(e/60)}m ago`:e<86400?`${Math.floor(e/3600)}h ago`:`${Math.floor(e/86400)}d ago`};return V({title:"Audit Trail | Admin"}),(r,e)=>(a(),l("div",j,[t("div",D,[e[2]||(e[2]=t("div",null,[t("h2",{class:"text-2xl font-black uppercase tracking-widest"},"Audit Trail"),t("p",{class:"text-sm text-gray-500 mt-1"},"Track user flow, page visits, and chat interactions.")],-1)),t("button",{onClick:c,class:"p-3 bg-white text-gray-600 hover:text-black border border-gray-200 rounded-lg hover:bg-gray-50 transition-all shadow-sm"},[(a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:h(["h-5 w-5",{"animate-spin":n.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...e[1]||(e[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))])]),t("div",M,[t("div",P,[e[3]||(e[3]=t("div",{class:"absolute -right-4 -top-4 w-24 h-24 bg-blue-50 rounded-full blur-2xl"},null,-1)),e[4]||(e[4]=t("p",{class:"text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2"},"Total Visitors",-1)),t("p",E,o(i.value.totalVisitors||0),1)]),t("div",N,[e[5]||(e[5]=t("div",{class:"absolute -right-4 -top-4 w-24 h-24 bg-green-50 rounded-full blur-2xl"},null,-1)),e[6]||(e[6]=t("p",{class:"text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2"},"Today's Visitors",-1)),t("p",R,o(i.value.todayVisitors||0),1)]),t("div",z,[e[7]||(e[7]=t("div",{class:"absolute -right-4 -top-4 w-24 h-24 bg-purple-50 rounded-full blur-2xl"},null,-1)),e[8]||(e[8]=t("p",{class:"text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2"},"Total Page Views",-1)),t("p",F,o(i.value.totalPageViews||0),1)]),t("div",H,[e[9]||(e[9]=t("div",{class:"absolute -right-4 -top-4 w-24 h-24 bg-yellow-50 rounded-full blur-2xl"},null,-1)),e[10]||(e[10]=t("p",{class:"text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2"},"Active Sessions",-1)),t("p",U,o(i.value.recentSessions?.length||0),1)])]),t("div",I,[t("div",L,[t("div",q,[e[12]||(e[12]=t("h3",{class:"text-sm font-black uppercase tracking-widest"},"Recent Activity Streams",-1)),C(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),onChange:c,class:"text-xs border-gray-200 rounded-lg px-2 py-1 outline-none"},[...e[11]||(e[11]=[t("option",{value:""},"All Events",-1),t("option",{value:"page_visit"},"Page Visits",-1),t("option",{value:"chat_message"},"Chat Messages",-1),t("option",{value:"bot_reply"},"Bot Replies",-1)])],544),[[B,g.value]])]),t("div",G,[n.value&&u.value.length===0?(a(),l("div",J,[...e[13]||(e[13]=[t("div",{class:"w-6 h-6 border-2 border-gray-200 border-t-black rounded-full animate-spin mx-auto"},null,-1)])])):p("",!0),(a(!0),l(b,null,v(u.value,s=>(a(),l("div",{key:s._id,class:"flex gap-4"},[t("div",K,[t("div",{class:h(["w-2 h-2 rounded-full ring-4",y(s.event)])},null,2),e[14]||(e[14]=t("div",{class:"w-px h-full bg-gray-100 mt-2"},null,-1))]),t("div",O,[t("div",Q,[t("div",null,[t("span",W,o(f(s.event)),1),t("span",X,o(s.guestName||"Anonymous User"),1)]),t("span",Y,o(w(s.createdAt)),1)]),s.page?(a(),l("p",Z,[e[15]||(e[15]=$("Visited: ",-1)),t("span",tt,o(s.page),1)])):p("",!0),s.metadata?.contentPreview?(a(),l("p",et,'"'+o(s.metadata.contentPreview)+'..."',1)):p("",!0),t("p",st,"Session ID: "+o(s.sessionId.substring(0,8))+"...",1)])]))),128))])]),t("div",ot,[t("div",rt,[e[16]||(e[16]=t("div",{class:"p-6 border-b border-gray-50"},[t("h3",{class:"text-sm font-black uppercase tracking-widest"},"Top Visited Pages")],-1)),t("div",at,[(a(!0),l(b,null,v(i.value.topPages,s=>(a(),l("div",{key:s._id,class:"flex justify-between items-center p-2 hover:bg-gray-50 rounded-lg"},[t("span",lt,o(s._id||"/"),1),t("span",it,o(s.count)+" views",1)]))),128))])]),t("div",nt,[e[17]||(e[17]=t("div",{class:"p-6 border-b border-gray-50"},[t("h3",{class:"text-sm font-black uppercase tracking-widest"},"Recent Sessions")],-1)),t("div",dt,[(a(!0),l(b,null,v(i.value.recentSessions?.slice(0,5),s=>(a(),l("div",{key:s._id,class:"p-3 border border-gray-100 rounded-xl bg-gray-50/50"},[t("p",ut,o(s.guestName||"Anonymous"),1),t("p",gt,o(s.guestEmail||"No Email"),1),t("div",ct,[t("span",pt,o(s.events)+" events",1),t("span",bt,o(_(s.lastActivity)),1)])]))),128))])])])])]))}});export{ht as default};
