{"version":3,"file":"useAuth-B5P4vKBX.js","sources":["../../../../../../nuxt/dist/app/composables/state.js","../../../../../../../app/composables/useAuth.ts"],"sourcesContent":["import { isRef, toRef } from \"vue\";\nimport { useNuxtApp } from \"../nuxt.js\";\nimport { toArray } from \"../utils.js\";\nconst useStateKeyPrefix = \"$s\";\nexport function useState(...args) {\n  const autoKey = typeof args[args.length - 1] === \"string\" ? args.pop() : void 0;\n  if (typeof args[0] !== \"string\") {\n    args.unshift(autoKey);\n  }\n  const [_key, init] = args;\n  if (!_key || typeof _key !== \"string\") {\n    throw new TypeError(\"[nuxt] [useState] key must be a string: \" + _key);\n  }\n  if (init !== void 0 && typeof init !== \"function\") {\n    throw new Error(\"[nuxt] [useState] init must be a function: \" + init);\n  }\n  const key = useStateKeyPrefix + _key;\n  const nuxtApp = useNuxtApp();\n  const state = toRef(nuxtApp.payload.state, key);\n  if (state.value === void 0 && init) {\n    const initialValue = init();\n    if (isRef(initialValue)) {\n      nuxtApp.payload.state[key] = initialValue;\n      return initialValue;\n    }\n    state.value = initialValue;\n  }\n  return state;\n}\nexport function clearNuxtState(keys) {\n  const nuxtApp = useNuxtApp();\n  const _allKeys = Object.keys(nuxtApp.payload.state).map((key) => key.substring(useStateKeyPrefix.length));\n  const _keys = !keys ? _allKeys : typeof keys === \"function\" ? _allKeys.filter(keys) : toArray(keys);\n  for (const _key of _keys) {\n    const key = useStateKeyPrefix + _key;\n    if (key in nuxtApp.payload.state) {\n      nuxtApp.payload.state[key] = void 0;\n    }\n  }\n}\n","export const useAuth = () => {\n  const { fetchWithAuth } = useApi();\n  const user = useState('auth_user', () => null);\n  const token = useCookie('auth_token', {\n    maxAge: 60 * 60 * 24, // 1 day\n    path: '/',\n  });\n\n  const isLoggedIn = computed(() => !!token.value);\n\n  const register = async (data: any) => {\n    try {\n      const response = await fetchWithAuth('/auth/register', {\n        method: 'POST',\n        body: data,\n      });\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  const login = async (data: any) => {\n    try {\n      const response: any = await fetchWithAuth('/auth/login', {\n        method: 'POST',\n        body: data,\n      });\n      token.value = response.accessToken;\n      user.value = response.user;\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    token.value = null;\n    user.value = null;\n    navigateTo('/login');\n  };\n\n  return {\n    user,\n    token,\n    isLoggedIn,\n    register,\n    login,\n    logout,\n  };\n};\n"],"names":[],"mappings":";;;AAGA,MAAM,oBAAoB;AACnB,SAAS,YAAY,MAAM;AAChC,QAAM,UAAU,OAAO,KAAK,KAAK,SAAS,CAAC,MAAM,WAAW,KAAK,IAAG,IAAK;AACzE,MAAI,OAAO,KAAK,CAAC,MAAM,UAAU;AAC/B,SAAK,QAAQ,OAAO;AAAA,EACtB;AACA,QAAM,CAAC,MAAM,IAAI,IAAI;AACrB,MAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;AACrC,UAAM,IAAI,UAAU,6CAA6C,IAAI;AAAA,EACvE;AACA,MAAI,SAAS,UAAU,OAAO,SAAS,YAAY;AACjD,UAAM,IAAI,MAAM,gDAAgD,IAAI;AAAA,EACtE;AACA,QAAM,MAAM,oBAAoB;AAChC,QAAM,UAAU,WAAU;AAC1B,QAAM,QAAQ,MAAM,QAAQ,QAAQ,OAAO,GAAG;AAC9C,MAAI,MAAM,UAAU,UAAU,MAAM;AAClC,UAAM,eAAe,KAAI;AACzB,QAAI,MAAM,YAAY,GAAG;AACvB,cAAQ,QAAQ,MAAM,GAAG,IAAI;AAC7B,aAAO;AAAA,IACT;AACA,UAAM,QAAQ;AAAA,EAChB;AACA,SAAO;AACT;AC5BO,MAAM,UAAU,MAAM;AAC3B,QAAM,EAAE,cAAA,IAAkB,OAAA;AAC1B,QAAM,OAAO,SAAS,aAAa,MAAM,IAAI;AAC7C,QAAM,QAAQ,UAAU,cAAc;AAAA,IACpC,QAAQ,KAAK,KAAK;AAAA;AAAA,IAClB,MAAM;AAAA,EAAA,CACP;AAED,QAAM,aAAa,SAAS,MAAM,CAAC,CAAC,MAAM,KAAK;AAE/C,QAAM,WAAW,OAAO,SAAc;AACpC,QAAI;AACF,YAAM,WAAW,MAAM,cAAc,kBAAkB;AAAA,QACrD,QAAQ;AAAA,QACR,MAAM;AAAA,MAAA,CACP;AACD,aAAO;AAAA,IACT,SAAS,OAAO;AACd,YAAM;AAAA,IACR;AAAA,EACF;AAEA,QAAM,QAAQ,OAAO,SAAc;AACjC,QAAI;AACF,YAAM,WAAgB,MAAM,cAAc,eAAe;AAAA,QACvD,QAAQ;AAAA,QACR,MAAM;AAAA,MAAA,CACP;AACD,YAAM,QAAQ,SAAS;AACvB,WAAK,QAAQ,SAAS;AACtB,aAAO;AAAA,IACT,SAAS,OAAO;AACd,YAAM;AAAA,IACR;AAAA,EACF;AAEA,QAAM,SAAS,MAAM;AACnB,UAAM,QAAQ;AACd,SAAK,QAAQ;AACb,eAAW,QAAQ;AAAA,EACrB;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;"}